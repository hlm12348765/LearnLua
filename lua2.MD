# Lua学习笔记(二)

![Lua](https://www.w3cschool.cn/attachments/image/20170622/1498119030897469.png)

[**教程地址**](https://www.w3cschool.cn/lua)
***

## 五. 流程控制

![条件](https://img.w3cschool.cn/attachments/image/20160829/1472467898120531.png)

### 控制结构语句
|语句|描述|
|----|---|
|if语句|if 语句 由一个布尔表达式作为条件判断，其后紧跟其他语句组成。|
|if...else语句|if 语句 可以与 else 语句搭配使用, 在 if 条件表达式为 `false` 时执行 else 语句代码。|
|if嵌套语句|你可以在if 或 else if中使用一个或多个 if 或 else if 语句 。|

***
## 六. 函数
### 1. 函数定义

<pre><code>optional_function_scope function function_name (argument1, argument2...argumentn)
   function_body
  return result_params_comma_separated
end
</code></pre>

* **optional_function_scope**  
 该参数是可选的制定函数是全局函数还是局部函数，未设置该参数末尾为全局函数，如果你需要设置函数为局部函数需要使用关键字 `local`。

Lua中可以将函数作为参数传递给函数。
可变参数在函数参数列表中用...表示，Lua将函数的参数放在一个叫`arg`的表中，`#arg` 表示传入参数的个数。
***
## 七. 运算符
* 算术运算符
* 关系运算符
* 逻辑运算符
* 其他运算符

|运算符|描述|运算符|描述|
|------|---|------|---|
|+|加法|==|等于|
|-|减法|~=|不等于|
|*|乘法|>|大于|
|/|除法|<|小于|
|%|取模|>=|大于等于|
|^|乘幂|<=|小于等于|
|-|负号|and|逻辑与|
|or|逻辑或|not|逻辑非|
|..|连接两个字符串|#|返回字符串或表的长度|

**`#`在获取表的长度时，根据的是表的最大索引的值，下标越过 1 位以上，最大索引无效**  

* 运算符优先级

 <pre><code> ^
  not    - (unary)
  `*`      /
  `+`      -
  ..
  <      >      <=     >=     ~=     ==
  and
  or
</code></pre>

***

## 八. 字符串
**字符串或串(String)是由数字、字母、下划线组成的一串字符。**
### 1. 表示方式：
* 单引号间的一串字符
* 双引号间的一串字符
* [[和]]间的一串字符

### 2. 转义字符

 |转义字符|意义|转义字符|意义|
 |-------|----|-------|----|
 |\a|响铃|\\|反斜杠|
 |\b|退格|\'|单引号|
 |\f|换页|\"|双引号|
 |\n|换行|\0|空字符NULL|
 |\r|回车|\ddd|1到3位八进制数所代表的任意字符|
 |\t|水平制表符|\xhh|1到2位十六进制所代表的字符|
 |\v|垂直制表符|

### 3. 字符串操作
|方法|用途|
|----|---|
|string.upper(argument)|字符串全部转为大写字母|
|string.lower(argument)|字符串全部转为小写字母|
|string.gsub(mianString,findString,replaceString,num)|在字符串中替换,mainString为要替换的字符串， findString 为被替换的字符，replaceString 要替换的字符，num 替换次数（可以忽略，则全部替换）|
|string.find(str,substr,[init,[end]])|在一个指定的目标字符串中搜索指定的内容(第三个参数为索引),返回其具体位置。不存在则返回 nil。|
|string.reverse(arg)|字符串反转|
|string.format(...)|返回一个类似printf的格式化字符串|
|string.char(arg)|将整型数字转成字符并连接|
|string.byte(arg[,sinit])|转换字符为整数值(可以指定某个字符，默认第一个字符)|
|string.len(arg)|返回字符串长度|
|string.rep(string, n)|返回字符串string的n个拷贝|
|..|连接两个字符串|
|string.gmatch(str,pattern)|返回一个迭代器函数，每一次调用这个函数，返回一个在字符串 str 找到的下一个符合 pattern 描述的子串。如果参数 pattern 描述的字符串没有找到，迭代函数返回nil|
|string.match(str,pattern,init)|string.match()只寻找源字串str中的第一个配对. 参数init可选, 指定搜寻过程的起点, 默认为1。 在成功配对时, 函数将返回配对表达式中的所有捕获结果; 如果没有设置捕获标记, 则返回整个配对字符串. 当没有成功的配对时, 返回nil。|

### 4. 字符串格式化
|转义码|意义|
|------|----|
|%c|接受一个数字, 并将其转化为ASCII码表中对应的字符|
|%d, %i|接受一个数字并将其转化为有符号的整数格式|
|%o|接受一个数字并将其转化为八进制数格式|
|%u|接受一个数字并将其转化为无符号整数格式|
|%x|接受一个数字并将其转化为十六进制数格式, 使用小写字母|
|%X|接受一个数字并将其转化为十六进制数格式, 使用大写字母|
|%e|接受一个数字并将其转化为科学记数法格式, 使用小写字母e|
|%E|接受一个数字并将其转化为科学记数法格式, 使用大写字母E|
|%f|接受一个数字并将其转化为浮点数格式|
|%g(%G)|接受一个数字并将其转化为%e(%E, 对应%G)及%f中较短的一种格式|
|%q|接受一个字符串并将其转化为可安全被Lua编译器读入的格式|
|%s|接受一个字符串并按照给定的参数格式化该字符串|

**为进一步细化格式, 可以在%号后添加参数. 参数将以如下的顺序读入:**
* 符号：一个+号表示其后的数字转义符将让正数显示正号. 默认情况下只有负数显示符号。
* 占位符: 一个0, 在后面指定了字串宽度时占位用. 不填时的默认占位符是空格。
* 对齐标识: 在指定了字串宽度时, 默认为右对齐, 增加-号可以改为左对齐。
* 宽度数值
* 小数位数/字串裁切: 在宽度数值后增加的小数部分n, 若后接f(浮点数转义符, 如`%6.3f`)则设定该浮点数的小数只保留n位, 若后接s(字符串转义符, 如`%5.3s`)则设定该字符串只显示前n位.

### 5. 匹配模式
字符类指可以匹配一个特定字符集合内任何字符的模式项，单个字符(除`^$()%.[]*+-?`外): 与该字符自身配对。

|字符类|意义|
|-----|----|
|.|与任何字符配对|
|%a|与任何字母配对|
|%c|与任何控制符配对(例如\n)|
|%d|与任何数字配对|
|%l|与任何小写字母配对|
|%p|与任何标点符号配对|
|%s|与空白字符配对|
|%u|与任何大写字母配对|
|%w|与任何字母/数字配对|
|%x|与任何十六进制字符配对|
|%z|与任何代表0的字符配对|
|%x|(此处x是非字母非数字字符)与字符x配对. 主要用来处理表达式中有功能的字符`^$()%.[]*+-?`的配对问题, 例如%%与%配对|
|[几个字符类]|与任何[]中包含的字符类配对. 例如[%w_]与任何字母/数字, 或下划线符号(_)配对|
|[^几个字符类]|与任何不包含在[]中的字符类配对. 例如[^%s]与任何非空白字符配对|
**当上述的字符类用大写书写时, 表示与非此字符类的任何字符配对. 例如, %S表示与任何非空白字符配对.例如，'%A'非字母的字符**
>'%' 用作特殊字符的转义字符，因此 '%.' 匹配点；'%%' 匹配字符 '%'。转义字符 '%'不仅可以用来转义特殊字符，还可以用于所有的非字母的字符。

**模式条目可以是：**
* 单个字符类匹配该类别中任意单个字符
* 单个字符类跟一个`*`，将匹配零或多个该类的字符，匹配尽可能长的串
* 单个字符类跟一个`-`，将匹配零或多个该类的字符，匹配尽可能短的串
* 单个字符类跟一个`+`，将匹配一或更多个该类的字符，匹配尽可能长的串
* 单个字符类跟一个`?`，将匹配零或一个该类的字符。 只要有可能，它会匹配一个
* `%n`，这里的 n 可以从 1 到 9； 这个条目匹配一个等于 n 号捕获物的子串。
* `%bxy`，这里的 x 和 y 是两个明确的字符； 这个条目匹配以 x 开始 y 结束， 且其中 x 和 y 保持 平衡 的字符串。 意思是，如果从左到右读这个字符串，对每次读到一个 x 就 +1 ，读到一个 y 就 -1， 最终结束处的那个 y 是第一个记数到 0 的 y。 举个例子，条目 `%b()` 可以匹配到括号平衡的表达式。
* `%f[set]`，指 边境模式； 这个条目会匹配到一个位于 set 内某个字符之前的一个空串， 且这个位置的前一个字符不属于 set 。 集合 set 的含义如前面所述。 匹配出的那个空串之开始和结束点的计算就看成该处有个字符 '\0' 一样。

**模式**  
>`模式`指一个模式条目的序列。 在模式最前面加上符号 `'^'` 将锚定从字符串的开始处做匹配。 在模式最后面加上符号 `'$'` 将使匹配过程锚定到字符串的结尾。 如果 '^' 和 '$' 出现在其它位置，它们均没有特殊含义，只表示自身。

**捕获**  
>模式可以在内部用小括号括起一个子模式； 这些子模式被称为 捕获物。 当匹配成功时，由 捕获物 匹配到的字符串中的子串被保存起来用于未来的用途。 捕获物以它们左括号的次序来编号。 例如，对于模式 `"(a*(.)%w(%s*))"` ， 字符串中匹配到 `"a*(.)%w(%s*)"` 的部分保存在第一个捕获物中 （因此是编号 1 ）； 由 `"."` 匹配到的字符是 2 号捕获物， 匹配到 `"%s*"` 的那部分是 3 号。  

>作为一个特例，空的捕获 `()` 将捕获到当前字符串的位置（它是一个数字）。 例如，如果将模式 `"()aa()"` 作用到字符串 `"flaaap"` 上，将产生两个捕获物： 3 和 5 。

***
## 九. 数组
### 1. 一维数组
**一维数组的逻辑结构是线性表**
### 2. 多维数组
**多维数组即数组中包含数组或一维数组的索引键对应一个数组。**
>数组设定指定的索引值，可以避免出现 nil 值，有利于节省内存空间。

***
## 十. 迭代器
>**迭代器（iterator）是一种对象，它能够用来遍历标准模板库容器中的部分或全部元素，每个迭代器对象代表容器中的确定的地址**

>**在Lua中迭代器是一种支持指针类型的结构，它可以遍历集合的每一个元素。**

### 1. 泛型for迭代器
>泛型for在自己内部保存迭代函数，实际上它保存三个值：迭代函数、状态常量、控制变量。  
>泛型for迭代器提供了集合的key/value对。

<pre><code>for k, v in pairs(t) do
    print(k, v)
end
</code></pre>

**泛型for的执行过程**
>* 首先，初始化，计算in后面表达式的值，表达式应该返回泛型 for 需要的三个值：迭代函数、状态常量、控制变量；与多值赋值一样，如果表达式返回的结果个数不足三个会自动用nil补足，多出部分会被忽略。  
>* 第二，将状态常量和控制变量作为参数调用迭代函数（注意：对于for结构来说，状态常量没有用处，仅仅在初始化时获取他的值并传递给迭代函数）。  
>* 第三，将迭代函数返回的值赋给变量列表。  
>* 第四，如果返回的第一个值为nil循环结束，否则执行循环体。  
>* 第五，回到第二步再次调用迭代函数。

### 2. 无形态的迭代器
>无状态的迭代器是指不保留任何状态的迭代器，因此在循环中我们可以利用无状态迭代器避免创建闭包花费额外的代价。  

>每一次迭代，迭代函数都是用两个变量（状态常量和控制变量）的值作为参数被调用，一个无状态的迭代器只利用这两个值可以获取下一个元素。  

>这种无状态迭代器的典型的简单的例子是ipairs，它遍历数组的每一个元素。  

>迭代的状态包括被遍历的表（循环过程中不会改变的状态常量）和当前的索引下标（控制变量）

### 3. 多状态的迭代器
>很多情况下，迭代器需要保存多个状态信息而不是简单的状态常量和控制变量，最简单的方法是使用闭包，还有一种方法就是将所有的状态信息封装到table内，将table作为迭代器的状态常量，因为这种情况下可以将所有的信息存放在table内，所以迭代函数通常不需要第二个参数。  

<pre><code>array = {"Lua", "Tutorial"}

function elementIterator(collection)
  local index = 0
  local count = #collection
  -- 闭包函数
  return function()
    index = index + 1
    if index <= count
    then
      -- 返回迭代器的当前元素
      return collection[index]
    end
  end
end

for element in elementIterator(array)
do
  print(element)
end
</code></pre>

以上代码输出结果为：
<pre><code>Lua
Tutorial
</code></pre>



以上实例中我们可以看到，`elementIterator` 内使用了闭包函数，实现计算集合大小并输出各个元素。  

>pairs 和 ipairs异同  
同：都是能遍历集合（表、数组）

>异：ipairs 仅仅遍历值，按照索引升序遍历，索引中断停止遍历。即不能返回 nil,只能返回数字 0，如果遇到 nil 则退出。它只能遍历到集合中出现的第一个不是整数的 key。

>pairs 能遍历集合的所有元素。即 pairs 可以遍历集合中所有的 key，并且除了迭代器本身以及遍历表本身还可以返回 nil。
